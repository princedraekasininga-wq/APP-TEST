<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stallz Loans - Client Portal</title>
    <link rel="icon" type="image/png" href="myfavicon.png">

    <link rel="stylesheet" href="client-portal.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@200;300;400;600;700;800;900&display=swap" rel="stylesheet">
</head>
<body>

    <div class="portal-shell">

        <header class="glass-header fade-in">
            <div class="header-left">
                <div class="logo-box">
                    <img src="my-logo.png" alt="Stallz Logo" class="portal-logo">
                </div>
                <h2 class="brand-title" id="headerGreeting">Hello, <span id="headerUserName">User</span></h2>
            </div>

            <div class="header-right">
                <div class="notification-wrapper">
                    <button class="icon-btn notification-btn" onclick="toggleNotifications()">
                        <i class="fas fa-bell"></i>
                        <span class="notification-dot"></span>
                    </button>
                    <div id="notificationDropdown" class="notification-dropdown">
                        <div class="dropdown-header">Recent Activity</div>
                        <div id="notificationList" class="dropdown-body">
                            <div class="notify-item">Welcome to Stallz Loans!</div>
                        </div>
                    </div>
                </div>

                <button class="profile-btn" onclick="openProfileModal()">
                    <i class="fas fa-user-cog"></i>
                </button>
            </div>
        </header>

        <div class="welcome-banner fade-in">
            <h1 class="welcome-text">WELCOME TO STALLZ LOANS</h1>
        </div>

        <div class="hero-section fade-in delay-1">
            <div class="stat-card hero-split-layout">
                <div class="hero-top-row">
                    <div class="hero-left-content">
                        <div class="hero-header-row">
                            <div class="static-icon-box"><i class="fas fa-chart-line"></i></div>
                            <span class="hero-section-label">Loan Progress</span>
                        </div>

                        <h1 class="big-percent-display" id="paymentProgressDisplay">0%</h1>

                        <p class="due-date-row">
                            <i class="far fa-calendar-alt" style="margin-right: 6px; color:var(--primary);"></i>
                            Next Due: <span id="nextDueDisplay" style="font-weight: 700; color: #fff;">--</span>
                        </p>
                    </div>

                    <div class="hero-right-visual">
                        <div class="hero-ring-container">
                            <svg class="progress-ring" width="160" height="160" viewBox="0 0 160 160">
                                <circle class="ring-track" cx="80" cy="80" r="70" fill="none" stroke-width="12" stroke-linecap="round" />

                                <circle id="progressCircle" class="ring-progress" cx="80" cy="80" r="70" fill="none" stroke-width="12" stroke-linecap="round" />

                                <circle id="innerCircle" cx="80" cy="80" r="58" />
                            </svg>

                            <div class="ring-center-content">
                                <span id="daysRemaining" class="days-left-number">--</span>
                                <span class="days-left-label">Days Left</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="advice-box fade-in delay-2">
            <p class="advice-text">
                <span style="color:#ffffff; font-weight:200; margin-right:5px; letter-spacing:0.5px;">STALLZ ADVICE:</span>
                Consistent partial payments reduce your burden significantly compared to a single lump-sum payment at the deadline.
            </p>
        </div>

        <div class="stats-grid fade-in delay-2">
            <div class="stat-card blue-glow compact-card">
                <div class="icon-box small-icon"><i class="fas fa-wallet"></i></div>
                <div class="stat-info">
                    <p class="label small-label">Balance</p>
                    <h3 class="money-text small-money" id="portalTotalDebt">K0.00</h3>
                </div>
            </div>

            <div class="stat-card green-glow compact-card">
                <div class="icon-box small-icon"><i class="fas fa-check-double"></i></div>
                <div class="stat-info">
                    <p class="label small-label">Paid</p>
                    <h3 class="money-text small-money" id="portalTotalPaid">K0.00</h3>
                </div>
            </div>
        </div>

        <section class="glass-panel fade-in delay-3" style="margin-bottom: 100px;">
            <div class="panel-header">
                <h2><i class="fas fa-history"></i> Loan History</h2>
            </div>

            <div class="table-responsive">
                <table class="portal-table">
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Amount</th>
                            <th>Total Due</th>
                            <th>Paid</th>
                            <th>Balance</th>
                        </tr>
                    </thead>
                    <tbody id="portalLoansTable">
                        </tbody>
                </table>
            </div>
        </section>

    </div>

    <nav class="mobile-bottom-nav">
        <a href="#" class="nav-item" id="nav-request" onclick="openRequestModal()">
            <div class="nav-icon"><i class="fas fa-hand-holding-usd"></i></div>
            <span class="nav-label">Request</span>
        </a>

        <a href="#" class="nav-item center-item" id="nav-calc" onclick="openCalcModal()">
            <div class="nav-icon big-nav-icon"><i class="fas fa-calculator"></i></div>
        </a>

        <a href="#" class="nav-item" id="nav-proof" onclick="openUploadModal()">
            <div class="nav-icon"><i class="fas fa-camera"></i></div>
            <span class="nav-label">Proof</span>
        </a>
    </nav>

    <div id="profileModal" class="modal-overlay">
        <div class="modal-glass">
            <div class="modal-header" style="display:flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h3>My Profile</h3>
                <button onclick="closeProfileModal()" class="close-btn" style="background:none; border:none; color:var(--text-main); font-size:1.5rem;">&times;</button>
            </div>
            <div class="modal-body">
                <div class="profile-details" style="display: flex; flex-direction: column; gap: 15px;">
                    <p style="border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 10px;">
                        <strong style="color:var(--primary)">Phone:</strong> <br> <span id="modalPhone">--</span>
                    </p>
                    <p style="border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 10px;">
                        <strong style="color:var(--primary)">ID Number:</strong> <br> <span id="modalID">--</span>
                    </p>
                    <p>
                        <strong style="color:var(--primary)">Address:</strong> <br> <span id="modalAddress">--</span>
                    </p>
                </div>
                <button onclick="closeProfileModal()" class="btn-full" style="margin-top:25px; width:100%; padding:14px; background:var(--primary); border:none; color:white; border-radius:12px; font-weight:700; cursor:pointer;">Close Profile</button>
            </div>
        </div>
    </div>

    <div id="calcModal" class="modal-overlay">
        <div class="modal-glass">
            <div class="modal-header">
                <h3>Loan Estimator</h3>
                <button onclick="closeCalcModal()" class="close-btn">&times;</button>
            </div>
            <div class="modal-body">
                <div class="calc-group">
                    <div class="calc-label-row">
                        <label>I want to borrow</label>
                        <span class="calc-value-display" id="calcAmountDisplay">K500</span>
                    </div>
                    <input type="range" min="100" max="5000" step="50" value="500" class="calc-slider" id="calcRange">
                </div>

                <div class="calc-group">
                    <label style="display:block; margin-bottom:10px; font-size:0.8rem; color:var(--text-muted)">Duration</label>
                    <div class="duration-toggles" id="durationSelector">
                        <button class="dur-btn active" data-rate="0.20">1 Wk</button>
                        <button class="dur-btn" data-rate="0.30">2 Wk</button>
                        <button class="dur-btn" data-rate="0.35">3 Wk</button>
                        <button class="dur-btn" data-rate="0.40">1 Mo</button>
                    </div>
                </div>

                <div class="calc-result-box">
                    <div class="result-row">
                        <span>Interest</span>
                        <span id="calcInterestDisplay" style="color:var(--primary)">20%</span>
                    </div>
                    <div class="result-row total-row">
                        <span>Repay</span>
                        <span id="calcTotalDisplay">K600.00</span>
                    </div>
                </div>
                <button class="btn-full" onclick="closeCalcModal()">Done</button>
            </div>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <script src="client-portal.js"></script>
</body>
</html>